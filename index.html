<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>مفاجأة جنس المولود — QR</title>
  <meta name="theme-color" content="#f6a5c0" />
  <style>
    :root{
      --pink:#f9a8d4; --pink-deep:#ec4899;
      --blue:#93c5fd; --blue-deep:#3b82f6;
      --bg1:#fff7fb; --bg2:#f0f7ff;
      --panel:#ffffff; --ring:rgba(0,0,0,.06);
      --text:#111827; --muted:#6b7280; --ok:#10b981; --danger:#ef4444;
    }
    @media (prefers-color-scheme: dark){
      :root{
        --bg1:#0f172a; --bg2:#0b1220; --panel:#0b1220; --ring:rgba(255,255,255,.08);
        --text:#e5e7eb; --muted:#9ca3af;
      }
      body{ background: radial-gradient(1200px 800px at 80% -20%, #1e293b33, transparent), linear-gradient(135deg,var(--bg1),var(--bg2)) }
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:"Noto Sans Arabic", system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Tahoma, Arial;
      background:linear-gradient(135deg,var(--bg1),var(--bg2));
      color:var(--text);
      display:flex;align-items:center;justify-content:center;
      padding:18px;
    }

    .card{
          width:100%;max-width:760px;background:var(--panel);
          border:1px solid var(--ring);border-radius:24px;
          box-shadow:0 20px 60px rgba(0,0,0,.08);overflow:hidden;position:relative;
        }

    /* HERO مع صورة السونار مغبّشة */
    .hero{
      position:relative;height:220px;
      background:
        radial-gradient(1000px 200px at 50% -120px,rgba(14,165,233,.35),transparent),
        radial-gradient(900px 200px at 50% -120px,rgba(236,72,153,.30),transparent);
      border-bottom:1px solid var(--ring);
      overflow:hidden;
    }
     .sonar-static{ position:absolute; inset:12px; border-radius:16px; overflow:hidden; }
    .sonar-static img{
      width:100%; height:100%; object-fit:cover;
      filter: blur(8px) brightness(.95) contrast(1.05);
      transform: scale(1.06);
    }

    /* confetti canvas sits on top only when celebrating */
    canvas.confetti{position:absolute;inset:0;pointer-events:none;z-index:5}

    .header{padding:22px 22px 10px;display:flex;gap:12px;align-items:center}
    .teddy{
      width:62px;height:62px;border-radius:16px;border:1px solid var(--ring);
      background:conic-gradient(from 220deg at 50% 0%, #ffdff4, #eef6ff);
      display:grid;place-items:center;box-shadow:0 8px 24px rgba(0,0,0,.08);
      transform:translateZ(0);
      animation:float 4s ease-in-out infinite;
    }
    @keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-4px)}}

    .title{margin:0 0 6px;font-weight:900;font-size:22px;color:var(--text)}
    .babyline{margin:0;color:var(--muted)}
    .body{padding:0 22px 22px;display:grid;gap:16px}

    .choices{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .choice{position:relative}
    .choice > input{position:absolute;inset:0;opacity:0}
    .btn{
      height:126px;border-radius:18px;border:1px solid var(--ring);
      display:grid;place-items:center;gap:10px;cursor:pointer;
      box-shadow:0 8px 18px rgba(0,0,0,.06);transition:transform .2s ease, box-shadow .2s ease, border-color .2s;
      background:#fff; outline: none; position:relative; overflow:hidden;
    }
    .btn:focus-visible{ box-shadow:0 0 0 3px color-mix(in oklab, var(--blue-deep) 30%, transparent) }
    .btn .ripple{ position:absolute; border-radius:50%; transform:scale(0); background: #0002; animation:ripple .6s linear }
    @keyframes ripple{ to{ transform:scale(12); opacity:0 } }

    .choice input:checked + .btn {
      border:2px solid var(--ok);
      box-shadow:0 0 0 4px color-mix(in oklab, var(--ok) 20%, transparent), 0 14px 28px rgba(0,0,0,.08);
      transform:translateY(-3px) scale(1.02);
    }
    .btn:hover{transform:translateY(-2px);box-shadow:0 14px 28px rgba(0,0,0,.08)}
    .btn .inner{display:flex;flex-direction:column;align-items:center;gap:8px}
    .btn svg{width:36px;height:36px}
    .btn.boy{background:linear-gradient(180deg,#eef6ff,#fff);}
    .btn.girl{background:linear-gradient(180deg,#fff0f7,#fff);}
    .label{font-weight:900;letter-spacing:.3px}
    .btn.boy .label{color:var(--blue-deep)}
    .btn.girl .label{color:var(--pink-deep)}

    .actions{display:flex;gap:10px;flex-wrap:wrap}
    button{
      border:0;border-radius:14px;padding:12px 16px;font-weight:800;cursor:pointer;
      box-shadow:0 6px 14px rgba(0,0,0,.06); display:inline-flex; align-items:center; gap:8px
    }
    button svg{ width:18px; height:18px }
    .save{background:linear-gradient(90deg,var(--pink-deep),var(--blue-deep));color:#fff; position:relative}
    .save.loading{ opacity:.9; pointer-events:none }
    .save .spinner{
      width:16px;height:16px;border-radius:999px;border:2px solid #fff6;border-left-color:#fff; animation:spin 0.9s linear infinite
    }
    @keyframes spin{ to{ transform:rotate(360deg) } }

    .clear{background:#f3f4f6;color:#374151;border:1px solid var(--ring)}
    .ok{ background: linear-gradient(90deg, #10b981, #22c55e); color:#fff }

    .qr-wrap{display:grid;place-items:center;padding:16px;border-radius:16px;background:linear-gradient(180deg,#fbfbff,#fff);border:1px solid var(--ring)}
    .qr-actions{display:flex;gap:10px;justify-content:center;flex-wrap:wrap}
    .footer{padding:12px 16px 18px;border-top:1px solid var(--ring);display:flex;justify-content:space-between;align-items:center;color:var(--muted);font-size:12px}
    .badge{padding:6px 10px;border-radius:999px;border:1px solid var(--ring)}
    .hidden{display:none!important}

    /* better focus ring for radios container */
    .choice input:focus-visible + .btn{ box-shadow:0 0 0 3px color-mix(in oklab, var(--pink-deep) 25%, transparent) }
  </style>
</head>
<body>
 <div class="card">
    <div class="hero">
      <div class="sonar-static">
        <img src="R.jpg?v=3" alt="صورة السونار">


      </div>
    </div>

  <div class="card" id="card">
    <div class="header">
      <div class="teddy" aria-hidden="true">
        <svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="دمية">
          <circle cx="22" cy="20" r="9" fill="#fbcfe8"/><circle cx="42" cy="20" r="9" fill="#bfdbfe"/>
          <circle cx="32" cy="34" r="20" fill="#fde68a"/>
          <circle cx="26" cy="32" r="4" fill="#1f2937"/><circle cx="38" cy="32" r="4" fill="#1f2937"/>
          <circle cx="32" cy="38" r="3" fill="#374151"/>
        </svg>
      </div>
      <div>
        <h1 class="title">بابا احمد وماما مريم.. عندي سرّ صغير! 🤫</h1>
        <p class="babyline">اختاري النوع وخَلّوه سرًا بيننا  💖💙</p>
      </div>
    </div>

    <div class="body">
      <div id="form" aria-live="polite">
        <fieldset class="choices" style="border:0; margin:0; padding:0">
          <legend class="hidden">اختيار جنس المولود</legend>

          <label class="choice">
            <input type="radio" name="gender" value="M" aria-label="ولد">
            <div class="btn boy" tabindex="0">
              <span class="inner">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" aria-hidden="true">
                  <circle cx="12" cy="7" r="3.5"/>
                  <path d="M4 22c0-4.4 3.6-8 8-8s8 3.6 8 8"/>
                </svg>
                <span class="label">ولد</span>
              </span>
            </div>
          </label>

          <label class="choice">
            <input type="radio" name="gender" value="F" aria-label="بنت">
            <div class="btn girl" tabindex="0">
              <span class="inner">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" aria-hidden="true">
                  <path d="M12 2a5 5 0 1 1 0 10 5 5 0 0 1 0-10Z"/>
                  <path d="M12 12v10M9 19h6"/>
                </svg>
                <span class="label">بنت</span>
              </span>
            </div>
          </label>
        </fieldset>

        <div class="actions" style="margin-top:12px">
          <button class="save" id="saveBtn" aria-label="حفظ وإنشاء رمز QR">
            <span class="btn-text">حفظ وإنشاء QR</span>
          </button>
          <button class="clear" id="resetBtn" title="مسح">مسح</button>
        </div>
      </div>

      <div id="qrSection" class="hidden" aria-live="polite">
        <div class="qr-wrap">
          <div id="qrcode" aria-label="رمز QR"></div>
        </div>
        <div class="qr-actions" style="margin-top:10px;">
          <button class="clear" id="downloadBtn" title="تنزيل PNG">
            <!-- download icon -->
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M12 3v12m0 0 4-4m-4 4-4-4"/><path d="M5 21h14"/></svg>
            تنزيل PNG
          </button>
          <button class="clear" id="copyBtn" title="نسخ الرابط">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><rect x="9" y="9" width="10" height="10" rx="2"/><path d="M15 9V7a2 2 0 0 0-2-2H7a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2"/></svg>
            نسخ الرابط
          </button>
          <button class="clear" id="shareBtn" title="مشاركة">🔗 مشاركة</button>
          <button class="ok" id="printBtn" title="طباعة">🖨️ طباعة</button>
          <button class="save" id="newBtn">إنشاء جديد</button>
        </div>
      </div>
    </div>

    <div class="footer">
      <span class="badge" id="status"></span>
      <span></span>
    </div>
  </div>

  <!-- QRCode lib -->
  <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
  <script>


    const dom = sel => document.querySelector(sel);
    const saveBtn = dom('#saveBtn');
    const resetBtn = dom('#resetBtn');
    const newBtn = dom('#newBtn');
    const form = dom('#form');
    const qrSection = dom('#qrSection');
    const statusEl = dom('#status');
    const downloadBtn = dom('#downloadBtn');
    const copyBtn = dom('#copyBtn');
    const shareBtn = dom('#shareBtn');
    const printBtn = dom('#printBtn');

    /* ——— helpers ——— */
    function libReady(){ return typeof QRCode !== 'undefined' && QRCode && QRCode.CorrectLevel; }
    function setBadge(msg, ok=true){
      statusEl.textContent = msg;
      statusEl.style.borderColor = ok? 'color-mix(in oklab, #10b981 60%, transparent)':'color-mix(in oklab, #ef4444 60%, transparent)';
    }
    function haptic(ms=15){ if('vibrate' in navigator) navigator.vibrate(ms); }
    function payload(g){
      const ts = new Date().toISOString();
      const raw = `GENDER:${g};TS:${ts};V:2`;
      return `${BASE_URL}#${encodeURIComponent(raw)}`;
    }

    /* ——— confetti ——— */
    let confettiCanvas;
    function confettiBurst(){
      if(confettiCanvas) confettiCanvas.remove();
      confettiCanvas = document.createElement('canvas');
      confettiCanvas.className = 'confetti';
      document.getElementById('card').appendChild(confettiCanvas);
      const ctx = confettiCanvas.getContext('2d');
      const {width, height} = confettiCanvas.parentElement.getBoundingClientRect();
      confettiCanvas.width = width; confettiCanvas.height = height;

      const pieces = Array.from({length: 140}).map(() => ({
        x: Math.random()*width, y: -20 - Math.random()*80,
        r: 4 + Math.random()*4,
        c: ['#f472b6','#60a5fa','#fde68a','#34d399','#fca5a5'][Math.floor(Math.random()*5)],
        vy: 2 + Math.random()*3, vx: -1 + Math.random()*2, rot: Math.random()*Math.PI
      }));

      let t = 0, anim;
      const draw = () => {
        t++;
        ctx.clearRect(0,0,width,height);
        pieces.forEach(p=>{
          p.x += p.vx; p.y += p.vy; p.rot += 0.05;
          ctx.save(); ctx.translate(p.x,p.y); ctx.rotate(p.rot);
          ctx.fillStyle = p.c; ctx.fillRect(-p.r/2,-p.r/2,p.r,p.r*1.6);
          ctx.restore();
        });
        if(t < 140) anim = requestAnimationFrame(draw); else confettiCanvas.remove();
      };
      anim = requestAnimationFrame(draw);
    }

    /* ——— QR ——— */
    function showQR(text){
      if(!libReady()){ setBadge('تعذّر تحميل مكتبة QR', false); return; }
      const box = document.getElementById('qrcode');
      box.innerHTML = '';
      const qr = new QRCode(box, {
        text, width: 260, height: 260, correctLevel: QRCode.CorrectLevel.M,
        colorDark: '#111827', colorLight: '#ffffff'
      });
      // accessibility: give alt text if <img> is used
      setTimeout(()=>{
        const img = box.querySelector('img');
        if(img){ img.alt = 'رمز QR لفتح صفحة الكشف'; }
      },0);
      qrSection.classList.remove('hidden');
    }

    /* ——— UI wiring ——— */
    function setLoading(btn, on){
      if(on){
        btn.classList.add('loading');
        btn.dataset.text = btn.querySelector('.btn-text')?.textContent || '';
        btn.innerHTML = '<span class="spinner" aria-hidden="true"></span> جارٍ الإنشاء...';
      }else{
        btn.classList.remove('loading');
        btn.innerHTML = '<span class="btn-text">'+(btn.dataset.text || 'حفظ وإنشاء QR')+'</span>';
      }
    }

    // ripple effect on .btn
    document.querySelectorAll('.choice .btn').forEach(b=>{
      b.addEventListener('click', e=>{
        const r = document.createElement('span');
        r.className='ripple';
        const rect = b.getBoundingClientRect();
        r.style.left = (e.clientX - rect.left) + 'px';
        r.style.top = (e.clientY - rect.top) + 'px';
        b.appendChild(r);
        setTimeout(()=>r.remove(), 600);
      });
      // keyboard activation
      b.addEventListener('keydown', e=>{
        if(e.key===' ' || e.key==='Enter'){ e.preventDefault(); b.click(); const inp=b.parentElement.querySelector('input'); inp.checked=true; }
      });
    });

    // persist selection
    const savedChoice = localStorage.getItem('baby_gender_choice');
    if(savedChoice){
      const inp = document.querySelector('input[name="gender"][value="'+savedChoice+'"]');
      if(inp){ inp.checked = true; }
    }

    window.BASE_URL = new URL('reveal.html', window.location.href).href;
    saveBtn.addEventListener('click', async ()=>{
      const sel = document.querySelector('input[name="gender"]:checked');
      if(!sel){ setBadge('اختاري النوع أولًا 💡', false); haptic(25); return; }

      localStorage.setItem('baby_gender_choice', sel.value);
      setLoading(saveBtn, true);

      // simulate quick processing
      await new Promise(r=>setTimeout(r, 400));

      const url = payload(sel.value);
      showQR(url);
      localStorage.setItem('baby_gender_qr_payload', url);
      form.classList.add('hidden');
      document.querySelectorAll('input[name="gender"]').forEach(r=>r.checked=false);
      setBadge('تم إنشاء رمز QR — جاهز للتنزيل 🎉');
      setLoading(saveBtn, false);
      confettiBurst();
      haptic(30);
    });

    resetBtn.addEventListener('click', ()=>{
      document.getElementById('qrcode').innerHTML = '';
      qrSection.classList.add('hidden');
      form.classList.remove('hidden');
      setBadge('جاهز');
      haptic(10);
    });

    downloadBtn.addEventListener('click', ()=>{
      const img = document.querySelector('#qrcode img');
      const canvas = document.querySelector('#qrcode canvas');
      let dataURL = '';
      if(canvas){ dataURL = canvas.toDataURL('image/png'); }
      else if(img){ dataURL = img.src; }
      if(!dataURL){ setBadge('تعذّر التحويل للصورة', false); return; }
      const a = document.createElement('a');
      a.href = dataURL; a.download = 'baby-gender-qr.png';
      a.click();
    });

    copyBtn.addEventListener('click', async ()=>{
      const url = localStorage.getItem('baby_gender_qr_payload');
      if(!url){ setBadge('لا يوجد رابط لنسخه', false); return; }
      try{
        await navigator.clipboard.writeText(url);
        setBadge('تم نسخ الرابط ✅');
      }catch(e){ setBadge('تعذّر النسخ', false); }
    });

    shareBtn.addEventListener('click', async ()=>{
      const url = localStorage.getItem('baby_gender_qr_payload');
      if(!url){ setBadge('لا يوجد ما يتم مشاركته', false); return; }
      if(navigator.share){
        try{
          await navigator.share({ title:'مفاجأة النوع', text:'سرّنا الصغير 🤫', url });
          setBadge('تمت المشاركة 🌟');
        }catch(e){ /* user cancelled */ }
      }else{
        setBadge('ميزة المشاركة غير مدعومة — تم نسخ الرابط بدلًا من ذلك ✅');
        try{ await navigator.clipboard.writeText(url); }catch{}
      }
    });

    printBtn.addEventListener('click', ()=> window.print());

    newBtn.addEventListener('click', ()=>{
      document.getElementById('qrcode').innerHTML = '';
      qrSection.classList.add('hidden');
      form.classList.remove('hidden');
      localStorage.removeItem('baby_gender_qr_payload');
      setBadge('جاهز لاختيار جديد');
    });

    // visual selection state
    document.querySelectorAll('.choice input').forEach(input => {
      input.addEventListener('change', () => {
        document.querySelectorAll('.choice .btn').forEach(btn => btn.classList.remove('selected'));
        input.nextElementSibling.classList.add('selected');
      });
    });
  </script>
</body>
</html>





